
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>sprung_plot</title><meta name="generator" content="MATLAB 8.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-05-05"><meta name="DC.source" content="sprung_plot.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Funktionskopf</a></li><li><a href="#2">Parameter-Structs der Funktion anlegen</a></li><li><a href="#3">Inputparameter &uuml;berpr&uuml;fen &amp; Parmeter-Struct f&uuml;llen (Inputs/ Flags)</a></li><li><a href="#5">Zielverzeichnis &amp; Dateiname des Plots</a></li><li><a href="#7">Konfiguration &amp; Ausf&uuml;hrung des Simulinkmodells sprung.mdl</a></li><li><a href="#11">LaTeX Outpung der Funktion und Plot der Simulation</a></li><li><a href="#15">Ende der Funktion und Pass bin</a></li><li><a href="#17">Beispiel 1 - F&uuml;hrungs&uuml;bertragungsfunktion, ann&auml;hernd aperiodisch</a></li><li><a href="#18">Beispiel 2 - F&uuml;hrungs&uuml;bertragungsfunktion, sichtbares &Uuml;berschwingen</a></li></ul></div><h2>Funktionskopf<a name="1"></a></h2><pre class="codeinput"><span class="comment">% +----------------------------------------------------------------------+</span>
<span class="comment">% | File     : sprung_plot.m                                             |</span>
<span class="comment">% | Title    : Unterprogramm Typ: function                               |</span>
<span class="comment">% | Typ      : Source                                                    |</span>
<span class="comment">% | Version  : HolyMoly-4.2 Kleborn/ Wulf                                |</span>
<span class="comment">% | Drawn    : 08.04.2014                                                |</span>
<span class="comment">% | Checked  : 24.04.2014                                                |</span>
<span class="comment">% | Released : 24.04.2014                                                |</span>
<span class="comment">% | Language : MATLAB Version R2012b                                     |</span>
<span class="comment">% +----------------------------------------------------------------------+</span>
<span class="comment">% | Description : Initialisierung des Simulinkmodells sprung.mdl         |</span>
<span class="comment">% |               und ausf&uuml;hren. Ploten der Sprungantwort des Modells.   |</span>
<span class="comment">% |               Anlegen von Dokumentationselementen                    |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% | Ausgabe :   1 Bin : 0 = Fehlerhafte Inputparameter                   |</span>
<span class="comment">% |                     1 = Fehlerhafte Flageingabe                      |</span>
<span class="comment">% |                     2 = Unbekanntes Flag oder Flagwert               |</span>
<span class="comment">% |                     3 = Zielpfad/ -datei nicht zugewiesen            |</span>
<span class="comment">% |                     4 = sprung.mdl nicht vorhanden                   |</span>
<span class="comment">% |                     5 = sprung_ws.mat nicht vorhanden                |</span>
<span class="comment">% |                     6 = sprung.mdl konnte nicht konfiguriert werden  |</span>
<span class="comment">% |                     7 = sprung.mdl konnte nicht ausgef&uuml;hrt werden    |</span>
<span class="comment">% |                     8 = LaTeX-String nicht erstellet                 |</span>
<span class="comment">% |                     9 = Plot fehlgeschlagen                          |</span>
<span class="comment">% |                    10 = Fehlerfrei durchgelaufen                     |</span>
<span class="comment">% |             2 Outputstruct mit Funktionsergebnissen                  |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% | Eingabe :   1 Z&auml;hlerpolynom des Modells als Zeilenvektor,            |</span>
<span class="comment">% |               Potenz abfallend                                       |</span>
<span class="comment">% |             2 Z&auml;hlerpolynom des Modells als Zeilenvektor,            |</span>
<span class="comment">% |               Potenz abfallend                                       |</span>
<span class="comment">% |             4 Variable Argumente ['flag',wert,...,'flagn',wertn]     |</span>
<span class="comment">% |               Durchschaltkonstante    flag = 'D'     wert = double   |</span>
<span class="comment">% |               Modellzeitbasis         flag = 'Tbase' wert = double   |</span>
<span class="comment">% |               1e-4 &lt;= Aufl&ouml;sung &lt; 1   flag = 'Res'   wert = double   |</span>
<span class="comment">% |               &Uuml;berschwingweite [%]    flag = 'Delta' wert = double   |</span>
<span class="comment">% |               F&uuml;hrungs-&Uuml;-Fkt.         flag = 'Typ'   wert = 'G_W'    |</span>
<span class="comment">% |               Regler-&Uuml;-Fkt.           flag = 'Typ'   wert = 'G_R'    |</span>
<span class="comment">% |               Strecken-&Uuml;-Fkt.         flag = 'Typ'   wert = 'G_S'    |</span>
<span class="comment">% +----------------------------------------------------------------------+</span>
<span class="comment">% | Call : [Outputparameter] = sprung_plot(Inputparameter)               |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% | Outputparameter :   1 bin                                            |</span>
<span class="comment">% |                     2 outputs                                        |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% | Inputparameter :    1 Z                                              |</span>
<span class="comment">% |                     2 N                                              |</span>
<span class="comment">% |                     3 varargin = [flagn,wertn]                       |</span>
<span class="comment">% +----------------------------------------------------------------------+</span>
<span class="comment">% | Ben&ouml;tigte Dateien :                                                  |</span>
<span class="comment">% |                                                                      |</span>
<span class="comment">% | sprung.mdl, sprung_ws.mat                                            |</span>
<span class="comment">% +----------------------------------------------------------------------+</span>

<span class="keyword">function</span> [ bin, outputs ] = sprung_plot(Z,N,varargin)
</pre><h2>Parameter-Structs der Funktion anlegen<a name="2"></a></h2><pre class="codeinput">outputs.fcn.Z = 0;          <span class="comment">% Z&auml;hler der &Uuml;-Fkt.</span>
outputs.fcn.N = 0;          <span class="comment">% Nenner der &Uuml;-Fkt.</span>
outputs.fcn.D = 0;          <span class="comment">% Durchsaltkonstante (optional)</span>
outputs.mdl.Tbase = 10;     <span class="comment">% Zeitbasis f&uuml;r Modell, z.B. t_max der &Uuml;ber-</span>
                            <span class="comment">% schwingweite oder die dominante Zeitkonstante</span>
                            <span class="comment">% des charackteristischen Polynoms</span>
outputs.mdl.Res = 1e-2;     <span class="comment">% Aufl&ouml;sung Fixed-Step / (StopTime - StartTime)</span>
outputs.mdl.Config = 0;     <span class="comment">% Simulink Konfigurationseinstellung</span>
outputs.mdl.t = 0;          <span class="comment">% Simulation-Output-Objekt (t,u,y,dy/dt)</span>
outputs.mdl.u = 0;
outputs.mdl.y = 0;
outputs.mdl.dy = 0;
outputs.plt.Delta = 0;      <span class="comment">% &Uuml;berschwingweite, Entscheidungshilfe f&uuml;r die</span>
                            <span class="comment">% Plotdarstellung</span>
outputs.plt.Typ = <span class="string">'G'</span>;      <span class="comment">% Standardplot falls nicht anders eingegeben</span>
outputs.plt.fpath = <span class="string">''</span>;     <span class="comment">% Speicherot der Figure</span>
outputs.plt.fname = <span class="string">''</span>;     <span class="comment">% Dateiname der Figure</span>
outputs.plt.latex = <span class="string">''</span>;     <span class="comment">% LaTeX-Code zur Darstellung der &Uuml;-Fkt.</span>
</pre><h2>Inputparameter &uuml;berpr&uuml;fen &amp; Parmeter-Struct f&uuml;llen (Inputs/ Flags)<a name="3"></a></h2><div><ul><li>Validierung der festen Inputparameter</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    validateattributes(Z,{<span class="string">'double'</span>},{<span class="string">'row'</span>,<span class="string">'real'</span>},<span class="string">'sprung_plot'</span>,<span class="string">'Z'</span>,1);
    validateattributes(N,{<span class="string">'double'</span>},{<span class="string">'row'</span>,<span class="string">'real'</span>},<span class="string">'sprung_plot'</span>,<span class="string">'N'</span>,2);
    outputs.fcn.Z = Z;
    outputs.fcn.N = N;
<span class="keyword">catch</span> inputException
    bin = 0;
    disp(inputException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre><div><ul><li>Validierung der variablen Flag-Inputparameter (varargin)</li></ul></div><pre class="codeinput"><span class="keyword">if</span> nargin &gt; 2
    <span class="comment">% Pr&uuml;fung ob immer Flag und Flagwert &uuml;bergeben worden sind</span>
    <span class="keyword">try</span>
        validateattributes(varargin,{<span class="string">'cell'</span>},{<span class="string">'row'</span>},<span class="string">'sprung_plot'</span>,<span class="string">''</span>,3);
        <span class="keyword">if</span> rem(length(varargin),2) ~= 0
            throw(MException(<span class="string">'ValidFlags:UnbalancedFlag'</span>,<span class="keyword">...</span>
                             <span class="string">'Flag ohne zugeh&ouml;rigen Wert eingegeben'</span>));
        <span class="keyword">end</span>
    <span class="keyword">catch</span> flagException
        bin = 1;
        disp(flagException.getReport());
        <span class="keyword">return</span>;
    <span class="keyword">end</span>
    <span class="comment">% Wandeln und Abspeichern der Flagwerte</span>
    <span class="keyword">try</span>
        <span class="keyword">for</span> i=1:2:length(varargin)
            flag = cell2mat(varargin(i));
            wert = cell2mat(varargin(i+1));
            <span class="keyword">switch</span> flag
                <span class="keyword">case</span> <span class="string">'D'</span>
                    <span class="keyword">if</span> isscalar(wert)
                        outputs.fcn.D = wert;
                    <span class="keyword">else</span>
                        throw(MException(<span class="string">'ValidFlag:WrongFlagValue'</span>,<span class="keyword">...</span>
                                         <span class="string">'"D" muss Scalar sein!'</span>));
                    <span class="keyword">end</span>
                <span class="keyword">case</span> <span class="string">'Tbase'</span>
                    <span class="keyword">if</span> isscalar(wert)
                        outputs.mdl.Tbase = wert;
                    <span class="keyword">else</span>
                        throw(MException(<span class="string">'ValidFlag:WrongFlagValue'</span>,<span class="keyword">...</span>
                                         <span class="string">'"TMax" muss Scalar sein!'</span>));
                    <span class="keyword">end</span>
                <span class="keyword">case</span> <span class="string">'Res'</span>
                    <span class="keyword">if</span> isscalar(and(wert &gt;= 1e-4, wert &lt; 1))
                        outputs.mdl.Res = wert;
                    <span class="keyword">else</span>
                        throw(MException(<span class="string">'ValidFlag:WrongFlagValue'</span>,<span class="keyword">...</span>
                                         <span class="string">'Aus&szlig;erhalb 1e-4 &lt;= Res &lt; 1 !'</span>));
                    <span class="keyword">end</span>
                <span class="keyword">case</span> <span class="string">'Delta'</span>
                    <span class="keyword">if</span> isscalar(wert)
                        outputs.plt.Delta = wert;
                    <span class="keyword">else</span>
                        throw(MException(<span class="string">'ValidFlag:WrongFlagValue'</span>,<span class="keyword">...</span>
                                         <span class="string">'"Delta" muss Scalar sein!'</span>));
                    <span class="keyword">end</span>
                <span class="keyword">case</span> <span class="string">'Typ'</span>
                    <span class="keyword">if</span> strcmp(wert,<span class="string">'G_S'</span>)
                        outputs.plt.Typ = wert;
                    <span class="keyword">elseif</span> strcmp(wert,<span class="string">'G_W'</span>)
                        outputs.plt.Typ = wert;
                    <span class="keyword">elseif</span> strcmp(wert,<span class="string">'G_R'</span>)
                        outputs.plt.Typ = wert;
                    <span class="keyword">else</span>
                        throw(MException(<span class="string">'ValidFlag:WrongFlagValue'</span>,<span class="keyword">...</span>
                                        [<span class="string">'Unbekannter Wert "'</span>,<span class="keyword">...</span>
                                          wert,<span class="keyword">...</span>
                                         <span class="string">'f&uuml;r Flag "Typ"!'</span>]));
                    <span class="keyword">end</span>
                <span class="keyword">otherwise</span>
                    throw(MException(<span class="string">'ValidFlag:UnknownFlag'</span>,<span class="keyword">...</span>
                                     <span class="string">'Unbekanntes Flag aufgetreten'</span>));
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">catch</span> flagUnknownException
        bin = 2;
        disp(flagUnknownException.getReport());
        <span class="keyword">return</span>;
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">% Ende der Inputparametervalidierung</span>
</pre><h2>Zielverzeichnis &amp; Dateiname des Plots<a name="5"></a></h2><p>Aktuelles Datum &amp; Zeit, Double gez&auml;hlt vom Januar 00-00-0000 Datumausgabe im gew&uuml;nschten Format z.B. Apr, 07 2014 - 13:15:34 Uhr Aktueller Arbeitsordner als String</p><pre>  date = now
  floor(now) % gibt Datum
  rem(now,1) % gibt Uhrzeit
  date = datestr(now,'mmm, dd yyyy - HH:MM:SS')
  path = pwd
  strcat(path,'\',date,' Uhr') %verbindet Strings</pre><pre class="codeinput"><span class="keyword">try</span>
    outputs.plt.fpath = strcat(pwd,<span class="string">'\Plots-'</span>,datestr(floor(now),<span class="keyword">...</span>
                                                 <span class="string">'yyyy-mmm-dd'</span>));
    <span class="keyword">if</span> exist(outputs.plt.fpath,<span class="string">'dir'</span>) ~= 7
        mkdir(outputs.plt.fpath);
    <span class="keyword">end</span>
    outputs.plt.fname = strcat(outputs.plt.Typ,<span class="string">'-'</span>,datestr(now,<span class="keyword">...</span>
                                                 <span class="string">'yyyymmdd-HH-MM-SS'</span>),<span class="string">'h'</span>);
<span class="keyword">catch</span> outputsException
        bin = 3;
        disp(outputsException.getReport());
        <span class="keyword">return</span>;
<span class="keyword">end</span>
<span class="comment">% Ende der Zielzuweisung</span>
</pre><h2>Konfiguration &amp; Ausf&uuml;hrung des Simulinkmodells sprung.mdl<a name="7"></a></h2><p>Ein zum Teil vorkonfigurietes ConfigSet-Objekt befindet sich bereits im Modell sprung.mdl. Das Setup wird jetzt geladen, angepasst und mit den zus&auml;tzlich ben&ouml;tigten Variablen in sprung_ws abgespeichert. Damit ist im Modell-WS immer der letzte Durchlauf vorhanden. Das Vorgehen bietet somit auch schutz vor externen Aufrufen der sprung.mdl Datei, zudem bleibt der Base-Workspace sauber.</p><div><ul><li>Pr&uuml;fen sprung.mdl im Arbeitsordner ist</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    <span class="keyword">if</span> exist(<span class="string">'sprung.mdl'</span>,<span class="string">'file'</span>) ~= 4
        bin = 4;
        throw(MException(<span class="string">'ExistModel:NoModel'</span>,<span class="keyword">...</span>
                         <span class="string">'Abbruch, sprung.mdl nicht vorhanden!'</span>));
    <span class="keyword">end</span>
<span class="keyword">catch</span> existException
    disp(existException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre><div><ul><li>Berechnen und laden der Modellparameter und -variablen</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    <span class="comment">% Ben&ouml;tiget Flagparameter in den Fkt.-WS zwischenspeichern</span>
    D = outputs.fcn.D;            <span class="comment">% Durschaltkonstante</span>
    Tbase = outputs.mdl.Tbase;    <span class="comment">% Zeitbasis</span>
    Res = outputs.mdl.Res;        <span class="comment">% Aufl&ouml;sung</span>

    <span class="comment">% Simulationsparameter aus Zeitbasis berechnen</span>
    Tstart = 0.0;                 <span class="comment">% Startzeit</span>
    Tstop = ceil(10 * Tbase);     <span class="comment">% Stopzeit</span>
    Ts = Res * Tstop;             <span class="comment">% Simulationsschrittweite</span>
    Smp = (Tstop - Tstart) / Ts; <span class="comment">% N Abtastwerte == length(mdlOut)</span>

    <span class="comment">% Modell laden und ConfigSet anpassen</span>
    mdl = <span class="string">'sprung'</span>;
    load_system(mdl);
    cs = getActiveConfigSet(mdl);
    mdl_cs = cs.copy;
    set_param(mdl_cs,<span class="string">'SolverMode'</span>,<span class="string">'Auto'</span>,<span class="keyword">...</span>
                     <span class="string">'Solver'</span>,<span class="string">'ode4'</span>,<span class="keyword">...</span>
                     <span class="string">'SolverType'</span>,<span class="string">'Fixed-Step'</span>,<span class="keyword">...</span>
                     <span class="string">'FixedStep'</span>,num2str(Ts),<span class="keyword">...</span>
                     <span class="string">'StartTime'</span>,num2str(Tstart),<span class="keyword">...</span>
                     <span class="string">'StopTime'</span>,num2str(Tstop),<span class="keyword">...</span>
                     <span class="string">'Name'</span>,<span class="string">'SprungConfig'</span>,<span class="keyword">...</span>
                     <span class="string">'SaveTime'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
                     <span class="string">'TimeSaveName'</span>,<span class="string">'t'</span>,<span class="keyword">...</span>
                     <span class="string">'SaveOutput'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
                     <span class="string">'OutputSaveName'</span>,<span class="string">'uydy'</span>,<span class="keyword">...</span>
                     <span class="string">'LimitDataPoints'</span>,<span class="string">'on'</span>,<span class="keyword">...</span>
                     <span class="string">'MaxDataPoints'</span>,num2str(Smp),<span class="keyword">...</span>
                     <span class="string">'SaveFormat'</span>,<span class="string">'Array'</span>,<span class="keyword">...</span>
                     <span class="string">'Decimation'</span>,<span class="string">'1'</span>);
    outputs.mdl.Config = mdl_cs.copy;

    <span class="comment">% Modellvariablen in den Model-WS speichern und laden</span>
    mdl_ws = get_param(mdl,<span class="string">'modelworkspace'</span>);
    mdl_ws.DataSource = <span class="string">'MAT-File'</span>;
    mdl_ws.FileName = <span class="string">'sprung_ws'</span>;
    mdl_ws.assignin(<span class="string">'D'</span>,D);
    mdl_ws.assignin(<span class="string">'Z'</span>,Z);
    mdl_ws.assignin(<span class="string">'N'</span>,N);
    mdl_ws.assignin(<span class="string">'Tbase'</span>,Tbase);
    mdl_ws.saveToSource;
    mdl_ws.reload;

<span class="keyword">catch</span> paramException
    bin = 6;
    disp(paramException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre><div><ul><li>Ausf&uuml;hren der Simulation und Ergebnisse f&uuml;r den Plot speichern</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    mdl_out = sim(mdl,mdl_cs);
    outputs.mdl.t = mdl_out.get(<span class="string">'t'</span>);
    uydy = mdl_out.get(<span class="string">'uydy'</span>);
    outputs.mdl.u = uydy(:,1);
    outputs.mdl.y = uydy(:,2);
    outputs.mdl.dy = uydy(:,3);
    close_system(mdl,1);
<span class="keyword">catch</span> runModelException
    bin = 7;
    disp(runModelException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
<span class="comment">% Ende der Konfiguration</span>
</pre><h2>LaTeX Outpung der Funktion und Plot der Simulation<a name="11"></a></h2><div><ul><li>LaTex-String der &Uuml;-Fkt. bauen</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    <span class="comment">% symbolische Variable anlegen</span>
    <span class="comment">% begrenzen des symbolischen Ausdrucks auf 6 Digits Dezimalzahlen ink.</span>
    <span class="comment">% Vorzeichen und Punkt</span>
    syms(<span class="string">'s'</span>);
    sD = vpa(D,6);
    sZ = vpa(poly2sym(Z,s),6);
    sN = vpa(poly2sym(N,s),6);
    f = vpa(sD + sZ / sN,6);
    <span class="comment">% Digits f&uuml;r die Stringverarbeitung auf 6 begrenzen und danach wieder</span>
    <span class="comment">% auf 32 zur&uuml;cksetzen</span>
    d1 = digits(6);
    outputs.plt.latex = [<span class="string">'$'</span>,outputs.plt.Typ,<span class="string">'(s)='</span>,latex(f),<span class="string">'$'</span>];
    digits(d1);
<span class="keyword">catch</span> latexParserException
    bin = 8;
    disp(latexParserException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre><div><ul><li>Plot der Sprungantwort</li></ul></div><pre class="codeinput"><span class="keyword">try</span>
    scrsz = get(0,<span class="string">'ScreenSize'</span>);
    shownFigure = figure(<span class="string">'Position'</span>,<span class="keyword">...</span>
        [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
    clf;
    hold <span class="string">on</span>;
    plot(outputs.mdl.t,outputs.mdl.u,<span class="string">'b'</span>,<span class="keyword">...</span><span class="comment"> % Sprung</span>
         outputs.mdl.t,outputs.mdl.y,<span class="string">'r'</span>);   <span class="comment">% Systemantwort</span>
    axis([outputs.mdl.t(1),max(outputs.mdl.t),<span class="keyword">...</span>
          min(outputs.mdl.y)-0.1,1.2*max(outputs.mdl.y)]);
    grid <span class="string">on</span>;
    legend(<span class="string">'u(t)'</span>,<span class="string">'y(t)'</span>);
    ylabel(<span class="string">'Sprungantwort'</span>,<span class="string">'FontSize'</span>,14);
    xlabel(<span class="string">'Zeit [sec]'</span>,<span class="string">'FontSize'</span>,14);
    title(outputs.plt.latex,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,16);
    <span class="comment">% Speichern</span>
    saveas(shownFigure,[outputs.plt.fpath,<span class="string">'\'</span>,<span class="keyword">...</span>
                        outputs.plt.fname,<span class="string">'.fig'</span>],<span class="string">'fig'</span>);
    hold <span class="string">off</span>;
<span class="keyword">catch</span> plotException
    bin = 9;
    disp(plotException.getReport());
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre><div><ul><li>Anlyse der Sprungantwort, f&uuml;r den Fall das Typ = 'G_W' ist.</li></ul></div><pre class="codeinput"><span class="keyword">if</span> strcmp(outputs.plt.Typ,<span class="string">'G_W'</span>)
    <span class="comment">% Bandgrenze des Systems</span>
    [fg,n] = max(outputs.mdl.dy);
    outputs.fcn.fg = fg;
    Tg = 1 / fg;
    <span class="comment">% Wendepunkt</span>
    tWP = outputs.mdl.t(n);
    yWP = outputs.mdl.y(n);
    <span class="comment">% Sprungmarke</span>
    <span class="keyword">for</span> n=1:Smp-1
        <span class="keyword">if</span>(outputs.mdl.u(n+1) &gt; 10*outputs.mdl.u(n))
            tSP = outputs.mdl.t(n);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="comment">% Verzugszeit</span>
    Tu = tWP - tSP - yWP / fg;
    outputs.fcn.Tu = Tu;
    <span class="comment">% Plot der Wendetangent und Wendepunkt</span>
    shownFigure = figure(<span class="string">'Position'</span>,<span class="keyword">...</span>
        [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
    clf;
    hold <span class="string">on</span>;
    plot(outputs.mdl.t,outputs.mdl.u,<span class="string">'b'</span>,<span class="keyword">...</span><span class="comment"> % Sprung</span>
         outputs.mdl.t,outputs.mdl.y,<span class="string">'r'</span>);   <span class="comment">% Systemantwort</span>
    grid <span class="string">on</span>;
    legend(<span class="string">'u(t)'</span>,<span class="string">'y(t)'</span>);
    ylabel(<span class="string">'Sprungantwort'</span>,<span class="string">'FontSize'</span>,14);
    xlabel(<span class="string">'Zeit [sec]'</span>,<span class="string">'FontSize'</span>,14);
    title(<span class="string">'Ausschnitt 1 von $G_W(s)$'</span>,<span class="string">'interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,16);
    plot([tSP+Tu,tSP+Tu+Tg],[0,max(outputs.mdl.u)],<span class="string">'k'</span>);
    plot(tWP,yWP,<span class="string">'g*'</span>);
    text(tWP,yWP,[<span class="string">'\leftarrow 1/T_g = '</span>,num2str(fg),],<span class="keyword">...</span>
        <span class="string">'FontSize'</span>,12);
    text(tSP+Tu,0,[<span class="string">'\leftarrow T_u = '</span>,num2str(tSP+Tu),<span class="keyword">...</span>
        <span class="string">' - '</span>,num2str(tSP),<span class="string">' = '</span>,num2str(Tu)],<span class="keyword">...</span>
        <span class="string">'FontSize'</span>,12);
    <span class="comment">% Zoomen</span>
    axis([tSP-Tu,tSP+Tg+2*Tu,-0.1,max(outputs.mdl.u)+0.1]);
    <span class="comment">% Speichern</span>
    saveas(shownFigure,[outputs.plt.fpath,<span class="string">'\'</span>,<span class="keyword">...</span>
                        outputs.plt.fname,<span class="string">'-01.fig'</span>],<span class="string">'fig'</span>);
    hold <span class="string">off</span>;
    <span class="comment">% &Uuml;berschwingweite gr&ouml;&szlig;er gleich 10[%], d.h. es gibt merklichen</span>
    <span class="comment">% Unterschwinger und somit eine Einschwingperiode</span>
    <span class="keyword">if</span> outputs.plt.Delta &gt;= 10.0
        <span class="comment">% Suche des 1. Sollwertdurchbruchs</span>
        <span class="keyword">for</span> n=1:Smp-1
            <span class="keyword">if</span> outputs.mdl.y(n+1) &gt;= max(outputs.mdl.u)
                tDP1 = outputs.mdl.t(n+1);
                <span class="keyword">break</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">% Ammplituden des ersten &Uuml;ber- Unterschwingers</span>
        yf = outputs.mdl.y(n+1:Smp);
        A1 = max(yf); [A2,k] = min(yf);
        <span class="comment">% Suche des 2. Sollwertdurchbruchs</span>
        <span class="keyword">for</span> n=n+k:Smp-1
            <span class="keyword">if</span> outputs.mdl.y(n+1) &gt;= max(outputs.mdl.u)
                tDP2 = outputs.mdl.t(n+1);
                <span class="keyword">break</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="comment">% &Uuml;berschwingerperiode</span>
        Te = tDP2 - tDP1;
        outputs.fcn.Te = Te;
        <span class="comment">% Plotten</span>
        shownFigure = figure(<span class="string">'Position'</span>,<span class="keyword">...</span>
            [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
        clf;
        hold <span class="string">on</span>;
        clf;
        plot(outputs.mdl.t,outputs.mdl.u,<span class="string">'b'</span>,<span class="keyword">...</span><span class="comment"> % Sprung</span>
             outputs.mdl.t,outputs.mdl.y,<span class="string">'r'</span>);   <span class="comment">% Systemantwort</span>
        grid <span class="string">on</span>;
        legend(<span class="string">'u(t)'</span>,<span class="string">'y(t)'</span>);
        ylabel(<span class="string">'Sprungantwort'</span>,<span class="string">'FontSize'</span>,14);
        xlabel(<span class="string">'Zeit [sec]'</span>,<span class="string">'FontSize'</span>,14);
        title(<span class="string">'Ausschnitt 2 von $G_W(s)$'</span>,<span class="keyword">...</span>
            <span class="string">'interpreter'</span>,<span class="string">'latex'</span>,<span class="string">'FontSize'</span>,16);

        text((tDP1+tDP2)/2,A1,<span class="keyword">...</span>
            [<span class="string">'T_e = '</span>,num2str(Te)],<span class="string">'FontSize'</span>,12);
        axis([tDP1,tDP2,A2-0.1,A1+0.1]);
        <span class="comment">% Speichern</span>
        saveas(shownFigure,[outputs.plt.fpath,<span class="string">'\'</span>,<span class="keyword">...</span>
                            outputs.plt.fname,<span class="string">'-02.fig'</span>],<span class="string">'fig'</span>);
        hold <span class="string">off</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">% Ende des Plotten</span>
</pre><h2>Ende der Funktion und Pass bin<a name="15"></a></h2><div><ul><li>Pass-Bin setzen</li></ul></div><pre class="codeinput">bin = 10;
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2>Beispiel 1 - F&uuml;hrungs&uuml;bertragungsfunktion, ann&auml;hernd aperiodisch<a name="17"></a></h2><pre class="language-matlab">Tbase = 50;
Delta = 0.2;
Z_S = 0.0005;
N_S = [1 0.4 0.0 0.0];
[bin, Result.G_S] = sprung_plot(Z_S,N_S,<span class="string">'Typ'</span>,<span class="string">'G_S'</span>)
Z_W = [0.0121];
N_W = [1 0.8694 0.1737 0.0121];
[bin, Result.G_W] = sprung_plot(Z_W,N_W,<span class="string">'Typ'</span>,<span class="string">'G_W'</span>,<span class="keyword">...</span>
                                        <span class="string">'Tbase'</span>,Tbase,<span class="keyword">...</span>
                                        <span class="string">'Delta'</span>,Delta,<span class="keyword">...</span>
                                        <span class="string">'Res'</span>,1e-4)
D_R = 24.2;
Z_R = [-11.3595 -4.2305];
N_R = [1 0.8694 0.1737];
[bin, Result.G_R] = sprung_plot(Z_R,N_R,<span class="string">'Res'</span>,1e-4,<span class="string">'Typ'</span>,<span class="string">'G_R'</span>,<span class="string">'D'</span>,D_R)
</pre><h2>Beispiel 2 - F&uuml;hrungs&uuml;bertragungsfunktion, sichtbares &Uuml;berschwingen<a name="18"></a></h2><pre class="language-matlab">t_max = 5;
Delta = 10.0;
Z_S = 16;
N_S = [625 500 150 20 1];
pole = roots(N_S);
domP = min(abs(pole));
<span class="keyword">if</span> domP ~= 0.0
   domT = 1 / domP;
<span class="keyword">else</span>
domT = 10.0
[bin, Result.G_S] = sprung_plot(Z_S,N_S,<span class="string">'Typ'</span>,<span class="string">'G_S'</span>,<span class="keyword">...</span>
                                        <span class="string">'Tbase'</span>,domT,<span class="keyword">...</span>
                                        <span class="string">'Res'</span>, 1e-3)
Z_W = [3.386];
N_W = [1 5.5271 10.1848 7.8258 3.386];
[bin, Result.G_W] = sprung_plot(Z_W,N_W,<span class="string">'Typ'</span>,<span class="string">'G_W'</span>,<span class="keyword">...</span>
                                        <span class="string">'Tbase'</span>,t_max,<span class="keyword">...</span>
                                        <span class="string">'Delta'</span>,Delta,<span class="keyword">...</span>
                                        <span class="string">'Res'</span>,1e-3)
D_R = 132.25;
Z_R = [-625.154 -1315.1998 -1030.7301 0.2116];
N_R = [1 5.5271 10.1848 7.8258 0];
[bin, Result.G_R] = sprung_plot(Z_R,N_R,<span class="string">'Res'</span>,1e-3,<span class="keyword">...</span>
                                        <span class="string">'Tbase'</span>,t_max,<span class="keyword">...</span>
                                        <span class="string">'Typ'</span>,<span class="string">'G_R'</span>,<span class="keyword">...</span>
                                        <span class="string">'D'</span>,D_R)
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Funktionskopf

% +REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH+
% | File     : sprung_plot.m                                             |
% | Title    : Unterprogramm Typ: function                               |
% | Typ      : Source                                                    |
% | Version  : HolyMoly-4.2 Kleborn/ Wulf                                |
% | Drawn    : 08.04.2014                                                |
% | Checked  : 24.04.2014                                                |
% | Released : 24.04.2014                                                |
% | Language : MATLAB Version R2012b                                     |
% +REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH+
% | Description : Initialisierung des Simulinkmodells sprung.mdl         |
% |               und ausführen. Ploten der Sprungantwort des Modells.   |
% |               Anlegen von Dokumentationselementen                    |
% |                                                                      |
% | Ausgabe :   1 Bin : 0 = Fehlerhafte Inputparameter                   |
% |                     1 = Fehlerhafte Flageingabe                      |
% |                     2 = Unbekanntes Flag oder Flagwert               |
% |                     3 = Zielpfad/ -datei nicht zugewiesen            |
% |                     4 = sprung.mdl nicht vorhanden                   |
% |                     5 = sprung_ws.mat nicht vorhanden                |
% |                     6 = sprung.mdl konnte nicht konfiguriert werden  |
% |                     7 = sprung.mdl konnte nicht ausgeführt werden    |
% |                     8 = LaTeX-String nicht erstellet                 |
% |                     9 = Plot fehlgeschlagen                          |
% |                    10 = Fehlerfrei durchgelaufen                     |
% |             2 Outputstruct mit Funktionsergebnissen                  |
% |                                                                      |
% | Eingabe :   1 Zählerpolynom des Modells als Zeilenvektor,            |
% |               Potenz abfallend                                       |
% |             2 Zählerpolynom des Modells als Zeilenvektor,            |
% |               Potenz abfallend                                       |
% |             4 Variable Argumente ['flag',wert,...,'flagn',wertn]     |
% |               Durchschaltkonstante    flag = 'D'     wert = double   |
% |               Modellzeitbasis         flag = 'Tbase' wert = double   |
% |               1e-4 <= Auflösung < 1   flag = 'Res'   wert = double   |
% |               Überschwingweite [%]    flag = 'Delta' wert = double   |
% |               Führungs-Ü-Fkt.         flag = 'Typ'   wert = 'G_W'    |
% |               Regler-Ü-Fkt.           flag = 'Typ'   wert = 'G_R'    |
% |               Strecken-Ü-Fkt.         flag = 'Typ'   wert = 'G_S'    |
% +REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH+
% | Call : [Outputparameter] = sprung_plot(Inputparameter)               |
% |                                                                      |
% |                                                                      |
% | Outputparameter :   1 bin                                            |
% |                     2 outputs                                        |
% |                                                                      |
% | Inputparameter :    1 Z                                              |
% |                     2 N                                              |
% |                     3 varargin = [flagn,wertn]                       |
% +REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH+
% | Benötigte Dateien :                                                  |
% |                                                                      |
% | sprung.mdl, sprung_ws.mat                                            |
% +REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH+

function [ bin, outputs ] = sprung_plot(Z,N,varargin)
%% Parameter-Structs der Funktion anlegen
outputs.fcn.Z = 0;          % Zähler der Ü-Fkt.
outputs.fcn.N = 0;          % Nenner der Ü-Fkt.
outputs.fcn.D = 0;          % Durchsaltkonstante (optional)
outputs.mdl.Tbase = 10;     % Zeitbasis für Modell, z.B. t_max der Über- 
                            % schwingweite oder die dominante Zeitkonstante
                            % des charackteristischen Polynoms
outputs.mdl.Res = 1e-2;     % Auflösung Fixed-Step / (StopTime - StartTime)
outputs.mdl.Config = 0;     % Simulink Konfigurationseinstellung
outputs.mdl.t = 0;          % Simulation-Output-Objekt (t,u,y,dy/dt)
outputs.mdl.u = 0;
outputs.mdl.y = 0;
outputs.mdl.dy = 0;
outputs.plt.Delta = 0;      % Überschwingweite, Entscheidungshilfe für die
                            % Plotdarstellung
outputs.plt.Typ = 'G';      % Standardplot falls nicht anders eingegeben
outputs.plt.fpath = '';     % Speicherot der Figure
outputs.plt.fname = '';     % Dateiname der Figure
outputs.plt.latex = '';     % LaTeX-Code zur Darstellung der Ü-Fkt.

%% Inputparameter überprüfen & Parmeter-Struct füllen (Inputs/ Flags)
% * Validierung der festen Inputparameter
try
    validateattributes(Z,{'double'},{'row','real'},'sprung_plot','Z',1);
    validateattributes(N,{'double'},{'row','real'},'sprung_plot','N',2);
    outputs.fcn.Z = Z;
    outputs.fcn.N = N;
catch inputException
    bin = 0;
    disp(inputException.getReport());
    return;
end
%%
% * Validierung der variablen Flag-Inputparameter (varargin)
if nargin > 2
    % Prüfung ob immer Flag und Flagwert übergeben worden sind
    try
        validateattributes(varargin,{'cell'},{'row'},'sprung_plot','',3);
        if rem(length(varargin),2) ~= 0
            throw(MException('ValidFlags:UnbalancedFlag',...
                             'Flag ohne zugehörigen Wert eingegeben'));
        end
    catch flagException
        bin = 1;
        disp(flagException.getReport());
        return;
    end
    % Wandeln und Abspeichern der Flagwerte
    try
        for i=1:2:length(varargin)
            flag = cell2mat(varargin(i));
            wert = cell2mat(varargin(i+1));
            switch flag
                case 'D'
                    if isscalar(wert)
                        outputs.fcn.D = wert;
                    else
                        throw(MException('ValidFlag:WrongFlagValue',...
                                         '"D" muss Scalar sein!'));
                    end
                case 'Tbase'
                    if isscalar(wert)
                        outputs.mdl.Tbase = wert;
                    else
                        throw(MException('ValidFlag:WrongFlagValue',...
                                         '"TMax" muss Scalar sein!'));
                    end
                case 'Res'
                    if isscalar(and(wert >= 1e-4, wert < 1))
                        outputs.mdl.Res = wert;
                    else
                        throw(MException('ValidFlag:WrongFlagValue',...
                                         'Ausßerhalb 1e-4 <= Res < 1 !'));
                    end
                case 'Delta'
                    if isscalar(wert)
                        outputs.plt.Delta = wert;
                    else
                        throw(MException('ValidFlag:WrongFlagValue',...
                                         '"Delta" muss Scalar sein!'));
                    end
                case 'Typ'
                    if strcmp(wert,'G_S')
                        outputs.plt.Typ = wert;
                    elseif strcmp(wert,'G_W')
                        outputs.plt.Typ = wert;
                    elseif strcmp(wert,'G_R')
                        outputs.plt.Typ = wert;
                    else
                        throw(MException('ValidFlag:WrongFlagValue',...
                                        ['Unbekannter Wert "',...
                                          wert,...
                                         'für Flag "Typ"!']));
                    end
                otherwise
                    throw(MException('ValidFlag:UnknownFlag',...
                                     'Unbekanntes Flag aufgetreten'));
            end
        end
    catch flagUnknownException
        bin = 2;
        disp(flagUnknownException.getReport());
        return;
    end        
end
% Ende der Inputparametervalidierung

%% Zielverzeichnis & Dateiname des Plots
% Aktuelles Datum & Zeit, Double gezählt vom Januar 00-00-0000
% Datumausgabe im gewünschten Format z.B. Apr, 07 2014 - 13:15:34 Uhr
% Aktueller Arbeitsordner als String
%%
%    date = now
%    floor(now) % gibt Datum
%    rem(now,1) % gibt Uhrzeit
%    date = datestr(now,'mmm, dd yyyy - HH:MM:SS') 
%    path = pwd
%    strcat(path,'\',date,' Uhr') %verbindet Strings
try
    outputs.plt.fpath = strcat(pwd,'\Plots-',datestr(floor(now),...
                                                 'yyyy-mmm-dd'));
    if exist(outputs.plt.fpath,'dir') ~= 7
        mkdir(outputs.plt.fpath);
    end
    outputs.plt.fname = strcat(outputs.plt.Typ,'-',datestr(now,...
                                                 'yyyymmdd-HH-MM-SS'),'h');
catch outputsException
        bin = 3;
        disp(outputsException.getReport());
        return;
end
% Ende der Zielzuweisung

%% Konfiguration & Ausführung des Simulinkmodells sprung.mdl
% Ein zum Teil vorkonfigurietes ConfigSet-Objekt befindet sich bereits im
% Modell sprung.mdl. Das Setup wird jetzt geladen, angepasst
% und mit den zusätzlich benötigten Variablen in sprung_ws abgespeichert.
% Damit ist im Modell-WS immer der letzte Durchlauf vorhanden.
% Das Vorgehen bietet somit auch schutz vor externen Aufrufen der
% sprung.mdl Datei, zudem bleibt der Base-Workspace sauber.

%%
% * Prüfen sprung.mdl im Arbeitsordner ist
try
    if exist('sprung.mdl','file') ~= 4
        bin = 4;
        throw(MException('ExistModel:NoModel',...
                         'Abbruch, sprung.mdl nicht vorhanden!'));
    end
catch existException
    disp(existException.getReport());
    return;
end
%%
% * Berechnen und laden der Modellparameter und -variablen
try
    % Benötiget Flagparameter in den Fkt.-WS zwischenspeichern
    D = outputs.fcn.D;            % Durschaltkonstante
    Tbase = outputs.mdl.Tbase;    % Zeitbasis
    Res = outputs.mdl.Res;        % Auflösung
    
    % Simulationsparameter aus Zeitbasis berechnen
    Tstart = 0.0;                 % Startzeit
    Tstop = ceil(10 * Tbase);     % Stopzeit
    Ts = Res * Tstop;             % Simulationsschrittweite
    Smp = (Tstop - Tstart) / Ts; % N Abtastwerte == length(mdlOut)

    % Modell laden und ConfigSet anpassen
    mdl = 'sprung';
    load_system(mdl);
    cs = getActiveConfigSet(mdl);
    mdl_cs = cs.copy;
    set_param(mdl_cs,'SolverMode','Auto',...
                     'Solver','ode4',...
                     'SolverType','Fixed-Step',...
                     'FixedStep',num2str(Ts),...
                     'StartTime',num2str(Tstart),...
                     'StopTime',num2str(Tstop),...
                     'Name','SprungConfig',...
                     'SaveTime','on',...
                     'TimeSaveName','t',...
                     'SaveOutput','on',...
                     'OutputSaveName','uydy',...
                     'LimitDataPoints','on',...
                     'MaxDataPoints',num2str(Smp),...
                     'SaveFormat','Array',...
                     'Decimation','1');
    outputs.mdl.Config = mdl_cs.copy;

    % Modellvariablen in den Model-WS speichern und laden
    mdl_ws = get_param(mdl,'modelworkspace');
    mdl_ws.DataSource = 'MAT-File';
    mdl_ws.FileName = 'sprung_ws';
    mdl_ws.assignin('D',D);
    mdl_ws.assignin('Z',Z);
    mdl_ws.assignin('N',N);
    mdl_ws.assignin('Tbase',Tbase);
    mdl_ws.saveToSource;
    mdl_ws.reload;
    
catch paramException
    bin = 6;
    disp(paramException.getReport());
    return;
end
%%
% * Ausführen der Simulation und Ergebnisse für den Plot speichern
try
    mdl_out = sim(mdl,mdl_cs);
    outputs.mdl.t = mdl_out.get('t');
    uydy = mdl_out.get('uydy');
    outputs.mdl.u = uydy(:,1);
    outputs.mdl.y = uydy(:,2);
    outputs.mdl.dy = uydy(:,3);
    close_system(mdl,1);
catch runModelException
    bin = 7;
    disp(runModelException.getReport());
    return;
end 
% Ende der Konfiguration

%% LaTeX Outpung der Funktion und Plot der Simulation
%%
% * LaTex-String der Ü-Fkt. bauen
try
    % symbolische Variable anlegen
    % begrenzen des symbolischen Ausdrucks auf 6 Digits Dezimalzahlen ink.
    % Vorzeichen und Punkt
    syms('s');
    sD = vpa(D,6);
    sZ = vpa(poly2sym(Z,s),6);
    sN = vpa(poly2sym(N,s),6);
    f = vpa(sD + sZ / sN,6);
    % Digits für die Stringverarbeitung auf 6 begrenzen und danach wieder
    % auf 32 zurücksetzen
    d1 = digits(6);
    outputs.plt.latex = ['$',outputs.plt.Typ,'(s)=',latex(f),'$'];
    digits(d1);
catch latexParserException
    bin = 8;
    disp(latexParserException.getReport());
    return;
end
%%
% * Plot der Sprungantwort
try
    scrsz = get(0,'ScreenSize');
    shownFigure = figure('Position',...
        [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
    clf;
    hold on;
    plot(outputs.mdl.t,outputs.mdl.u,'b',... % Sprung
         outputs.mdl.t,outputs.mdl.y,'r');   % Systemantwort
    axis([outputs.mdl.t(1),max(outputs.mdl.t),...
          min(outputs.mdl.y)-0.1,1.2*max(outputs.mdl.y)]);
    grid on;
    legend('u(t)','y(t)');
    ylabel('Sprungantwort','FontSize',14);
    xlabel('Zeit [sec]','FontSize',14);
    title(outputs.plt.latex,'interpreter','latex','FontSize',16);
    % Speichern
    saveas(shownFigure,[outputs.plt.fpath,'\',...
                        outputs.plt.fname,'.fig'],'fig');
    hold off;
catch plotException
    bin = 9;
    disp(plotException.getReport());
    return;
end
%%
% * Anlyse der Sprungantwort, für den Fall das Typ = 'G_W' ist.
if strcmp(outputs.plt.Typ,'G_W')
    % Bandgrenze des Systems
    [fg,n] = max(outputs.mdl.dy);
    outputs.fcn.fg = fg;
    Tg = 1 / fg;
    % Wendepunkt
    tWP = outputs.mdl.t(n);
    yWP = outputs.mdl.y(n);
    % Sprungmarke
    for n=1:Smp-1
        if(outputs.mdl.u(n+1) > 10*outputs.mdl.u(n))
            tSP = outputs.mdl.t(n);
        end
    end
    % Verzugszeit
    Tu = tWP - tSP - yWP / fg;
    outputs.fcn.Tu = Tu;
    % Plot der Wendetangent und Wendepunkt
    shownFigure = figure('Position',...
        [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
    clf;
    hold on;
    plot(outputs.mdl.t,outputs.mdl.u,'b',... % Sprung
         outputs.mdl.t,outputs.mdl.y,'r');   % Systemantwort
    grid on;
    legend('u(t)','y(t)');
    ylabel('Sprungantwort','FontSize',14);
    xlabel('Zeit [sec]','FontSize',14);
    title('Ausschnitt 1 von $G_W(s)$','interpreter','latex','FontSize',16);
    plot([tSP+Tu,tSP+Tu+Tg],[0,max(outputs.mdl.u)],'k');
    plot(tWP,yWP,'g*');
    text(tWP,yWP,['\leftarrow 1/T_g = ',num2str(fg),],...
        'FontSize',12);
    text(tSP+Tu,0,['\leftarrow T_u = ',num2str(tSP+Tu),...
        ' - ',num2str(tSP),' = ',num2str(Tu)],...
        'FontSize',12);
    % Zoomen
    axis([tSP-Tu,tSP+Tg+2*Tu,-0.1,max(outputs.mdl.u)+0.1]);
    % Speichern
    saveas(shownFigure,[outputs.plt.fpath,'\',...
                        outputs.plt.fname,'-01.fig'],'fig');
    hold off;
    % Überschwingweite größer gleich 10[%], d.h. es gibt merklichen
    % Unterschwinger und somit eine Einschwingperiode
    if outputs.plt.Delta >= 10.0
        % Suche des 1. Sollwertdurchbruchs
        for n=1:Smp-1
            if outputs.mdl.y(n+1) >= max(outputs.mdl.u)
                tDP1 = outputs.mdl.t(n+1);
                break;
            end
        end
        % Ammplituden des ersten Über- Unterschwingers
        yf = outputs.mdl.y(n+1:Smp);
        A1 = max(yf); [A2,k] = min(yf);
        % Suche des 2. Sollwertdurchbruchs
        for n=n+k:Smp-1
            if outputs.mdl.y(n+1) >= max(outputs.mdl.u)
                tDP2 = outputs.mdl.t(n+1);
                break;
            end
        end
        % Überschwingerperiode
        Te = tDP2 - tDP1;
        outputs.fcn.Te = Te;
        % Plotten
        shownFigure = figure('Position',...
            [1 scrsz(4)*0.2 scrsz(3)*0.8 scrsz(4)*0.6]);
        clf;
        hold on;
        clf;
        plot(outputs.mdl.t,outputs.mdl.u,'b',... % Sprung
             outputs.mdl.t,outputs.mdl.y,'r');   % Systemantwort
        grid on;
        legend('u(t)','y(t)');
        ylabel('Sprungantwort','FontSize',14);
        xlabel('Zeit [sec]','FontSize',14);
        title('Ausschnitt 2 von $G_W(s)$',...
            'interpreter','latex','FontSize',16);

        text((tDP1+tDP2)/2,A1,...
            ['T_e = ',num2str(Te)],'FontSize',12);
        axis([tDP1,tDP2,A2-0.1,A1+0.1]);
        % Speichern
        saveas(shownFigure,[outputs.plt.fpath,'\',...
                            outputs.plt.fname,'-02.fig'],'fig');
        hold off
    end
end
% Ende des Plotten
        
%% Ende der Funktion und Pass bin
% * Pass-Bin setzen
bin = 10;
end

%% Beispiel 1 - Führungsübertragungsfunktion, annähernd aperiodisch
%   Tbase = 50;
%   Delta = 0.2;
%   Z_S = 0.0005;
%   N_S = [1 0.4 0.0 0.0];
%   [bin, Result.G_S] = sprung_plot(Z_S,N_S,'Typ','G_S')
%   Z_W = [0.0121];
%   N_W = [1 0.8694 0.1737 0.0121];
%   [bin, Result.G_W] = sprung_plot(Z_W,N_W,'Typ','G_W',...
%                                           'Tbase',Tbase,...
%                                           'Delta',Delta,...
%                                           'Res',1e-4)
%   D_R = 24.2;
%   Z_R = [-11.3595 -4.2305];
%   N_R = [1 0.8694 0.1737];
%   [bin, Result.G_R] = sprung_plot(Z_R,N_R,'Res',1e-4,'Typ','G_R','D',D_R)

%% Beispiel 2 - Führungsübertragungsfunktion, sichtbares Überschwingen
%   t_max = 5;
%   Delta = 10.0;
%   Z_S = 16;
%   N_S = [625 500 150 20 1];
%   pole = roots(N_S);
%   domP = min(abs(pole));
%   if domP ~= 0.0
%      domT = 1 / domP;
%   else
%   domT = 10.0
%   [bin, Result.G_S] = sprung_plot(Z_S,N_S,'Typ','G_S',...
%                                           'Tbase',domT,...
%                                           'Res', 1e-3)
%   Z_W = [3.386];
%   N_W = [1 5.5271 10.1848 7.8258 3.386];
%   [bin, Result.G_W] = sprung_plot(Z_W,N_W,'Typ','G_W',...
%                                           'Tbase',t_max,...
%                                           'Delta',Delta,...
%                                           'Res',1e-3)
%   D_R = 132.25;
%   Z_R = [-625.154 -1315.1998 -1030.7301 0.2116];
%   N_R = [1 5.5271 10.1848 7.8258 0];
%   [bin, Result.G_R] = sprung_plot(Z_R,N_R,'Res',1e-3,...
%                                           'Tbase',t_max,...
%                                           'Typ','G_R',...
%                                           'D',D_R)
##### SOURCE END #####
--></body></html>